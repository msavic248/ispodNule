---
import { Icon } from 'astro-icon/components'

const navLinks = [
    { href: '/', text: 'Services' },
    { href: '/', text: 'Projects' },
    { href: '/', text: 'About' },
    { href: '/', text: 'Sponsors' },
    { href: '/', text: 'Contact' }
];
---

<script>
    import gsap from '../utils/gsap.js';

    const themeToggle = document.getElementById('theme-toggle');
    const lightIcon = document.querySelector('.theme-icon[data-mode="light"]');
    const darkIcon = document.querySelector('.theme-icon[data-mode="dark"]');
    
    type ThemeType = 'dark' | 'light';

    const getThemePreference = (): ThemeType => {
        if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            const savedTheme = localStorage.getItem('theme');
            return (savedTheme === 'dark' || savedTheme === 'light') ? savedTheme : 'light';
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    
    const applyTheme = (theme: ThemeType): void => {
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
            lightIcon?.classList.add('hidden');
            darkIcon?.classList.remove('hidden');
        } else {
            document.documentElement.classList.remove('dark');
            lightIcon?.classList.remove('hidden');
            darkIcon?.classList.add('hidden');
        }
        if (typeof localStorage !== 'undefined') {
            localStorage.setItem('theme', theme);
        }
    };

    // Initial theme setup
    const initialTheme = getThemePreference();
    applyTheme(initialTheme);
    
    themeToggle?.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        const newThemeToApply = isDark ? 'light' : 'dark';
        applyTheme(newThemeToApply);
    });

    // Existing scroll behavior for header
    let lastScrollY = window.scrollY;
    const header = document.getElementById('site-header');
    const handleScroll = () => {
        const currentScrollY = window.scrollY;
        if (Math.abs(currentScrollY - lastScrollY) < 5) return;
        if (currentScrollY > lastScrollY && currentScrollY > 50) {
            gsap.to(header, { opacity: 0, y: '-100%', duration: 0.2, ease: 'power1.in' });
        } else {
            gsap.to(header, { opacity: 1, y: '0%', duration: 0.2, ease: 'power1.in' });
        }
        lastScrollY = currentScrollY;
    };
    let scrollTimeout: number | undefined;
    window.addEventListener('scroll', () => {
        if (scrollTimeout) {
            window.cancelAnimationFrame(scrollTimeout);
        }
        scrollTimeout = window.requestAnimationFrame(handleScroll);
    }, { passive: true });
</script>

<header id="site-header" class="fixed w-full px-4 sm:px-6 lg:px-8 top-0 z-50 transition-all duration-300 ease-in-out">
    <div class="flex h-25 max-w-7xl mt-4 mx-auto">
        <nav class="bg-ispod-white/50 dark:bg-ispod-jet/50 backdrop-blur-sm flex items-center justify-between space-x-4 w-full border-b-4 dark:border-ispod-blue rounded-xl shadow hover:shadow-lg my-2 px-4 transition-all duration-300 ease-in-out">
            <a href="/" class="">
                <img class="h-25 w-auto aspect-square object-contain" src="/ispodNuleLogo.png" alt="Logo">
            </a>

            <div class="flex space-x-4">
                {navLinks.map(link => (
                    <a 
                    href={link.href} 
                    class="text-ispod-jet hover:text-ispod-yellow dark:text-ispod-white dark:hover:text-ispod-blue text-xl px-3 py-2 transition duration-150 ease-in-out"
                    >
                    {link.text}
                    </a>
                ))}
            </div>

            <div class="flex space-x-4">
                <button id="theme-toggle" class="text-ispod-jet dark:text-ispod-white hover:text-ispod-jet hover:bg-ispod-yellow hover:dark:bg-ispod-blue px-3 py-2 rounded-lg transition duration-150 ease-in-out cursor-pointer">
                    <Icon name="line-md:sunny" class="theme-icon" size="24" data-mode="light" /> 
                    <Icon name="line-md:moon" class="theme-icon hidden" size="24" data-mode="dark" />
                </button>
            </div>
        </nav>
    </div>
</header>

<style>
/* Minimal style to ensure body transition is smooth if not already handled by global styles */
/* body {
    transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out; 
} */
</style>